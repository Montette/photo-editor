(function(a,b){'object'==typeof exports&&'undefined'!=typeof module?module.exports=b():'function'==typeof define&&define.amd?define(b):a.Croppr=b()})(this,function(){'use strict';function a(a){a.addEventListener('touchstart',b),a.addEventListener('touchend',b),a.addEventListener('touchmove',b)}function b(a){a.preventDefault();var b=a.changedTouches[0];b.target.dispatchEvent(new MouseEvent({touchstart:'mousedown',touchmove:'mousemove',touchend:'mouseup'}[a.type],{bubbles:!0,cancelable:!0,view:window,clientX:b.clientX,clientY:b.clientY,screenX:b.screenX,screenY:b.screenY}))}function c(a,b){return+(d(a+'e'+b)+'e-'+b)}var d=Math.round;(function(){for(var a=0,b=['ms','moz','webkit','o'],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+'RequestAnimationFrame'],window.cancelAnimationFrame=window[b[c]+'CancelAnimationFrame']||window[b[c]+'CancelRequestAnimationFrame'];window.requestAnimationFrame||(window.requestAnimationFrame=function(b){var c=new Date().getTime(),d=Math.max(0,16-(c-a)),e=window.setTimeout(function(){b(c+d)},d);return a=c+d,e}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)})})(),function(){function a(a,b){b=b||{bubbles:!1,cancelable:!1,detail:void 0};var c=document.createEvent('CustomEvent');return c.initCustomEvent(a,b.bubbles,b.cancelable,b.detail),c}return'function'!=typeof window.CustomEvent&&void(a.prototype=window.Event.prototype,window.CustomEvent=a)}(),function(a){function b(b,c){c=c||{bubbles:!1,cancelable:!1};var d=document.createEvent('MouseEvent');return d.initMouseEvent(b,c.bubbles,c.cancelable,a,0,0,0,0,0,!1,!1,!1,!1,0,null),d}try{return new CustomEvent('test'),!1}catch(a){}b.prototype=Event.prototype,a.MouseEvent=b}(window);var e=function(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')},f=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,'value'in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=function a(b,c,d){null===b&&(b=Function.prototype);var e=Object.getOwnPropertyDescriptor(b,c);if(e===void 0){var f=Object.getPrototypeOf(b);return null===f?void 0:a(f,c,d)}if('value'in e)return e.value;var g=e.get;return void 0===g?void 0:g.call(d)},h=function(a,b){if('function'!=typeof b&&null!==b)throw new TypeError('Super expression must either be null or a function, not '+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)},i=function(a,b){if(!a)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return b&&('object'==typeof b||'function'==typeof b)?b:a},j=function(){function a(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!(b&&c.length===b));d=!0);}catch(a){e=!0,f=a}finally{try{!d&&h['return']&&h['return']()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError('Invalid attempt to destructure non-iterable instance')}}(),k=function a(b,c,d,f){function g(a){a.stopPropagation(),document.removeEventListener('mouseup',g),document.removeEventListener('mousemove',h),i.eventBus.dispatchEvent(new CustomEvent('handleend',{detail:{handle:i}}))}function h(a){a.stopPropagation(),i.eventBus.dispatchEvent(new CustomEvent('handlemove',{detail:{mouseX:a.clientX,mouseY:a.clientY}}))}e(this,a);var i=this;this.position=b,this.constraints=c,this.cursor=d,this.eventBus=f,this.el=document.createElement('div'),this.el.className='croppr-handle',this.el.style.cursor=d,this.el.addEventListener('mousedown',function(a){a.stopPropagation(),document.addEventListener('mouseup',g),document.addEventListener('mousemove',h),i.eventBus.dispatchEvent(new CustomEvent('handlestart',{detail:{handle:i}}))})},l=function(){function a(b,c,d,f){e(this,a),this.x1=b,this.y1=c,this.x2=d,this.y2=f}var b=Math.abs;return f(a,[{key:'set',value:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,d=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return this.x1=null==a?this.x1:a,this.y1=null==b?this.y1:b,this.x2=null==c?this.x2:c,this.y2=null==d?this.y2:d,this}},{key:'width',value:function(){return b(this.x2-this.x1)}},{key:'height',value:function(){return b(this.y2-this.y1)}},{key:'resize',value:function(a,b){var c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[0,0],d=this.x1+this.width()*c[0],e=this.y1+this.height()*c[1];return this.x1=d-a*c[0],this.y1=e-b*c[1],this.x2=this.x1+a,this.y2=this.y1+b,this}},{key:'scale',value:function(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[0,0],c=this.width()*a,d=this.height()*a;return this.resize(c,d,b),this}},{key:'move',value:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,c=this.width(),d=this.height();return a=null===a?this.x1:a,b=null===b?this.y1:b,this.x1=a,this.y1=b,this.x2=a+c,this.y2=b+d,this}},{key:'getRelativePoint',value:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[0,0],b=this.width()*a[0],c=this.height()*a[1];return[b,c]}},{key:'getAbsolutePoint',value:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[0,0],b=this.x1+this.width()*a[0],c=this.y1+this.height()*a[1];return[b,c]}},{key:'constrainToRatio',value:function(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[0,0],c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:'height';if(null!==a){var d=this.width(),e=this.height();return'height'===c?this.resize(this.width(),this.width()*a,b):'width'===c?this.resize(1*this.height()/a,this.height(),b):this.resize(this.width(),this.width()*a,b),this}}},{key:'constrainToBoundary',value:function(a,b){var c=Math.min,d=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[0,0],e=this.getAbsolutePoint(d),f=j(e,2),g=f[0],h=f[1],i=g,k=h,l=a-g,m=b-h,n=-2*d[0]+1,o=-2*d[1]+1,p=null,q=null;if(-1==n?p=i:0==n?p=2*c(i,l):1==n?p=l:void 0,-1==o?q=k:0==o?q=2*c(k,m):1==o?q=m:void 0,this.width()>p){var r=p/this.width();this.scale(r,d)}if(this.height()>q){var s=q/this.height();this.scale(s,d)}return this}},{key:'constrainToSize',value:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,d=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,e=4<arguments.length&&void 0!==arguments[4]?arguments[4]:[0,0],f=5<arguments.length&&void 0!==arguments[5]?arguments[5]:null;if(f&&(1<f?(a=1*b/f,d*=f):1>f&&(b=a*f,c=1*d/f)),a&&this.width()>a){var g=a,h=null===f?this.height():b;this.resize(g,h,e)}if(b&&this.height()>b){var i=null===f?this.width():a,j=b;this.resize(i,j,e)}if(c&&this.width()<c){var k=c,l=null===f?this.height():d;this.resize(k,l,e)}if(d&&this.height()<d){var m=null===f?this.width():c,n=d;this.resize(m,n,e)}return this}}]),a}(),m=[{position:[0,0],constraints:[1,0,0,1],cursor:'nw-resize'},{position:[0.5,0],constraints:[1,0,0,0],cursor:'n-resize'},{position:[1,0],constraints:[1,1,0,0],cursor:'ne-resize'},{position:[1,0.5],constraints:[0,1,0,0],cursor:'e-resize'},{position:[1,1],constraints:[0,1,1,0],cursor:'se-resize'},{position:[0.5,1],constraints:[0,0,1,0],cursor:'s-resize'},{position:[0,1],constraints:[0,0,1,1],cursor:'sw-resize'},{position:[0,0.5],constraints:[0,0,0,1],cursor:'w-resize'}],n=function(){function b(a,c){var d=this,f=2<arguments.length&&void 0!==arguments[2]&&arguments[2];if(e(this,b),this.options=b.parseOptions(c||{}),!a.nodeName&&(a=document.querySelector(a),null==a))throw'Unable to find element.';if(!a.getAttribute('src'))throw'Image src not provided.';this._initialized=!1,this._restore={parent:a.parentNode,element:a},f||(0===a.width||0===a.height?a.onload=function(){d.initialize(a)}:this.initialize(a))}return f(b,[{key:'initialize',value:function(a){this.createDOM(a),this.options.convertToPixels(this.cropperEl),this.attachHandlerEvents(),this.attachRegionEvents(),this.attachOverlayEvents(),this.box=this.initializeBox(this.options),this.redraw(),this._initialized=!0,null!==this.options.onInitialize&&this.options.onInitialize(this)}},{key:'createDOM',value:function(b){this.containerEl=document.createElement('div'),this.containerEl.className='croppr-container',this.eventBus=this.containerEl,a(this.containerEl),this.cropperEl=document.createElement('div'),this.cropperEl.className='croppr',this.imageEl=document.createElement('img'),this.imageEl.setAttribute('src',b.getAttribute('src')),this.imageEl.setAttribute('alt',b.getAttribute('alt')),this.imageEl.className='croppr-image',this.imageEl.classList.add('invisible'),this.imageClippedEl=this.imageEl.cloneNode(),this.imageClippedEl.className='croppr-imageClipped',this.regionEl=document.createElement('div'),this.regionEl.className='croppr-region',this.regionEl.classList.add('disabled'),this.overlayEl=document.createElement('div'),this.overlayEl.className='croppr-overlay',this.overlayEl.classList.add('invisible');var c=document.createElement('div');c.className='croppr-handleContainer',c.classList.add('disabled'),this.handles=[];for(var d,e=0;e<m.length;e++)d=new k(m[e].position,m[e].constraints,m[e].cursor,this.eventBus),this.handles.push(d),c.appendChild(d.el);this.cropperEl.appendChild(this.imageEl),this.cropperEl.appendChild(this.imageClippedEl),this.cropperEl.appendChild(this.regionEl),this.cropperEl.appendChild(this.overlayEl),this.cropperEl.appendChild(c),this.containerEl.appendChild(this.cropperEl),b.parentElement.replaceChild(this.containerEl,b)}},{key:'setImage',value:function(a){var b=this;return this.imageEl.onload=function(){b.box=b.initializeBox(b.options),b.redraw()},this.imageEl.src=a,this.imageClippedEl.src=a,this}},{key:'destroy',value:function(){this._restore.parent.replaceChild(this._restore.element,this.containerEl)}},{key:'initializeBox',value:function(a){var b=a.startSize.width,c=a.startSize.height,d=new l(0,0,b,c);d.constrainToRatio(a.aspectRatio,[0.5,0.5]);var e=a.minSize,f=a.maxSize;d.constrainToSize(f.width,f.height,e.width,e.height,[0.5,0.5],a.aspectRatio);var g=this.cropperEl.offsetWidth,h=this.cropperEl.offsetHeight;d.constrainToBoundary(g,h,[0.5,0.5]);var i=this.cropperEl.offsetWidth/2-d.width()/2,j=this.cropperEl.offsetHeight/2-d.height()/2;return d.move(i,j),d}},{key:'redraw',value:function(){var a=this,b=d(this.box.width()),c=d(this.box.height()),e=d(this.box.x1),f=d(this.box.y1),g=d(this.box.x2),h=d(this.box.y2);window.requestAnimationFrame(function(){a.regionEl.style.transform='translate('+e+'px, '+f+'px)',a.regionEl.style.width=b+'px',a.regionEl.style.height=c+'px',a.imageClippedEl.style.clip='rect('+f+'px, '+g+'px, '+h+'px, '+e+'px)',document.querySelector('.layer').style.clip='rect('+f+'px, '+g+'px, '+h+'px, '+e+'px)';for(var j=a.box.getAbsolutePoint([0.5,0.5]),k=j[0]-a.cropperEl.offsetWidth/2>>31,l=j[1]-a.cropperEl.offsetHeight/2>>31,m=0;m<a.handles.length;m++){var i=a.handles[m],n=i.el.offsetWidth,o=i.el.offsetHeight,p=e+b*i.position[0]-n/2,q=f+c*i.position[1]-o/2;i.el.style.transform='translate('+d(p)+'px, '+d(q)+'px)',i.el.style.zIndex=-2*((k^l)+l+l+4)+8==m?5:4}})}},{key:'attachHandlerEvents',value:function(){var a=this.eventBus;a.addEventListener('handlestart',this.onHandleMoveStart.bind(this)),a.addEventListener('handlemove',this.onHandleMoveMoving.bind(this)),a.addEventListener('handleend',this.onHandleMoveEnd.bind(this))}},{key:'attachRegionEvents',value:function(){function a(a){a.stopPropagation(),c.dispatchEvent(new CustomEvent('regionmove',{detail:{mouseX:a.clientX,mouseY:a.clientY}}))}function b(d){d.stopPropagation(),document.removeEventListener('mouseup',b),document.removeEventListener('mousemove',a),c.dispatchEvent(new CustomEvent('regionend',{detail:{mouseX:d.clientX,mouseY:d.clientY}}))}var c=this.eventBus,d=this;this.regionEl.addEventListener('mousedown',function(d){d.stopPropagation(),document.addEventListener('mouseup',b),document.addEventListener('mousemove',a),c.dispatchEvent(new CustomEvent('regionstart',{detail:{mouseX:d.clientX,mouseY:d.clientY}}))}),c.addEventListener('regionstart',this.onRegionMoveStart.bind(this)),c.addEventListener('regionmove',this.onRegionMoveMoving.bind(this)),c.addEventListener('regionend',this.onRegionMoveEnd.bind(this))}},{key:'attachOverlayEvents',value:function(){function a(a){a.stopPropagation(),c.eventBus.dispatchEvent(new CustomEvent('handlemove',{detail:{mouseX:a.clientX,mouseY:a.clientY}}))}function b(f){return f.stopPropagation(),document.removeEventListener('mouseup',b),document.removeEventListener('mousemove',a),1===c.box.width()&&1===c.box.height()?void(c.box=d):void c.eventBus.dispatchEvent(new CustomEvent('handleend',{detail:{mouseX:f.clientX,mouseY:f.clientY}}))}var c=this,d=null;this.overlayEl.addEventListener('mousedown',function(f){f.stopPropagation(),document.addEventListener('mouseup',b),document.addEventListener('mousemove',a);var e=c.cropperEl.getBoundingClientRect(),g=f.clientX-e.left,h=f.clientY-e.top;d=c.box,c.box=new l(g,h,g+1,h+1),c.eventBus.dispatchEvent(new CustomEvent('handlestart',{detail:{handle:c.handles[4]}}))})}},{key:'onHandleMoveStart',value:function(a){var b=a.detail.handle,c=[1-b.position[0],1-b.position[1]],d=this.box.getAbsolutePoint(c),e=j(d,2),f=e[0],g=e[1];this.activeHandle={handle:b,originPoint:c,originX:f,originY:g},null!==this.options.onCropStart&&this.options.onCropStart(this.getValue())}},{key:'onHandleMoveMoving',value:function(a){var b=a.detail,c=b.mouseX,d=b.mouseY,e=this.cropperEl.getBoundingClientRect();c-=e.left,d-=e.top,0>c?c=0:c>e.width&&(c=e.width),0>d?d=0:d>e.height&&(d=e.height);var f=this.activeHandle.originPoint.slice(),g=this.activeHandle.originX,h=this.activeHandle.originY,i=this.activeHandle.handle,j=1===i.constraints[0],k=1===i.constraints[1],m=1===i.constraints[2],n=1===i.constraints[3],o=n||k?g:this.box.x1,p=n||k?g:this.box.x2,q=j||m?h:this.box.y1,r=j||m?h:this.box.y2;o=n?c:o,p=k?c:p,q=j?d:q,r=m?d:r;var s=!1,t=!1;if((n||k)&&(s=n?c>g:c<g),(j||m)&&(t=j?d>h:d<h),s){var u=o;o=p,p=u,f[0]=1-f[0]}if(t){var v=q;q=r,r=v,f[1]=1-f[1]}var w=new l(o,q,p,r);if(this.options.aspectRatio){var x=this.options.aspectRatio,y=!1;(n||k)&&(j||m)?y=d>w.y1+x*w.width()||d<w.y2-x*w.width():(j||m)&&(y=!0);var z=y?'width':'height';w.constrainToRatio(x,f,z)}var A=this.options.minSize,B=this.options.maxSize;w.constrainToSize(B.width,B.height,A.width,A.height,f,this.options.aspectRatio);var C=this.cropperEl.offsetWidth,D=this.cropperEl.offsetHeight;w.constrainToBoundary(C,D,f),this.box=w,this.redraw(),null!==this.options.onCropMove&&this.options.onCropMove(this.getValue())}},{key:'onHandleMoveEnd',value:function(){null!==this.options.onCropEnd&&this.options.onCropEnd(this.getValue())}},{key:'onRegionMoveStart',value:function(a){var b=a.detail,c=b.mouseX,d=b.mouseY,e=this.cropperEl.getBoundingClientRect();c-=e.left,d-=e.top,this.currentMove={offsetX:c-this.box.x1,offsetY:d-this.box.y1},null!==this.options.onCropStart&&this.options.onCropStart(this.getValue())}},{key:'onRegionMoveMoving',value:function(a){var b=a.detail,c=b.mouseX,d=b.mouseY,e=this.currentMove,f=e.offsetX,g=e.offsetY,h=this.cropperEl.getBoundingClientRect();c-=h.left,d-=h.top,this.box.move(c-f,d-g),0>this.box.x1&&this.box.move(0,null),this.box.x2>h.width&&this.box.move(h.width-this.box.width(),null),0>this.box.y1&&this.box.move(null,0),this.box.y2>h.height&&this.box.move(null,h.height-this.box.height()),this.redraw(),null!==this.options.onCropMove&&this.options.onCropMove(this.getValue())}},{key:'onRegionMoveEnd',value:function(){null!==this.options.onCropEnd&&this.options.onCropEnd(this.getValue())}},{key:'getValue',value:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;if(null===a&&(a=this.options.returnMode),'real'==a){var b=this.imageEl.naturalWidth,e=this.imageEl.naturalHeight,f=this.imageEl.getBoundingClientRect(),g=f.width,h=f.height,i=b/g,j=e/h;return{x:d(this.box.x1*i),y:d(this.box.y1*j),width:d(this.box.width()*i),height:d(this.box.height()*j)}}if('ratio'==a){var k=this.imageEl.getBoundingClientRect(),l=k.width,m=k.height;return{x:c(this.box.x1/l,3),y:c(this.box.y1/m,3),width:c(this.box.width()/l,3),height:c(this.box.height()/m,3)}}return'raw'==a?{x:d(this.box.x1),y:d(this.box.y1),width:d(this.box.width()),height:d(this.box.height())}:void 0}}],[{key:'parseOptions',value:function(a){var b={aspectRatio:null,maxSize:{width:null,height:null},minSize:{width:null,height:null},startSize:{width:100,height:100,unit:'%'},returnMode:'real',onInitialize:null,onCropStart:null,onCropMove:null,onCropEnd:null},c=null;void 0!==a.aspectRatio&&('number'==typeof a.aspectRatio?c=a.aspectRatio:a.aspectRatio instanceof Array&&(c=a.aspectRatio[1]/a.aspectRatio[0]));var d=null;void 0!==a.maxSize&&null!==a.maxSize&&(d={width:a.maxSize[0]||null,height:a.maxSize[1]||null,unit:a.maxSize[2]||'px'});var e=null;void 0!==a.minSize&&null!==a.minSize&&(e={width:a.minSize[0]||null,height:a.minSize[1]||null,unit:a.minSize[2]||'px'});var f=null;void 0!==a.startSize&&null!==a.startSize&&(f={width:a.startSize[0]||null,height:a.startSize[1]||null,unit:a.startSize[2]||'%'});var g=null;'function'==typeof a.onInitialize&&(g=a.onInitialize);var h=null;'function'==typeof a.onCropStart&&(h=a.onCropStart);var i=null;'function'==typeof a.onCropEnd&&(i=a.onCropEnd);var j=null;'function'==typeof a.onUpdate&&(console.warn('Croppr.js: `onUpdate` is deprecated and will be removed in the next major release. Please use `onCropMove` or `onCropEnd` instead.'),j=a.onUpdate),'function'==typeof a.onCropMove&&(j=a.onCropMove);var k=null;if(void 0!==a.returnMode){var l=a.returnMode.toLowerCase();if(-1===['real','ratio','raw'].indexOf(l))throw'Invalid return mode.';k=l}var m=function(a,b){return null===a?b:a};return{aspectRatio:m(c,b.aspectRatio),maxSize:m(d,b.maxSize),minSize:m(e,b.minSize),startSize:m(f,b.startSize),returnMode:m(k,b.returnMode),onInitialize:m(g,b.onInitialize),onCropStart:m(h,b.onCropStart),onCropMove:m(j,b.onCropMove),onCropEnd:m(i,b.onCropEnd),convertToPixels:function(a){for(var b,c=a.offsetWidth,d=a.offsetHeight,e=['maxSize','minSize','startSize'],f=0;f<e.length;f++)b=e[f],null!==this[b]&&('%'==this[b].unit&&(null!==this[b].width&&(this[b].width=this[b].width/100*c),null!==this[b].height&&(this[b].height=this[b].height/100*d)),delete this[b].unit)}}}}]),b}(),o=function(a){function b(a,c){var d=2<arguments.length&&void 0!==arguments[2]&&arguments[2];return e(this,b),i(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c,d))}return h(b,a),f(b,[{key:'getValue',value:function(a){return g(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),'getValue',this).call(this,a)}},{key:'setImage',value:function(a){return g(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),'setImage',this).call(this,a)}},{key:'destroy',value:function(){return g(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),'destroy',this).call(this)}},{key:'moveTo',value:function(a,b){return this.box.move(a,b),this.redraw(),null!==this.options.onCropEnd&&this.options.onCropEnd(this.getValue()),this}},{key:'resizeTo',value:function(a,b){var c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[0.5,0.5];return this.box.resize(a,b,c),this.redraw(),null!==this.options.onCropEnd&&this.options.onCropEnd(this.getValue()),this}},{key:'scaleBy',value:function(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[0.5,0.5];return this.box.scale(a,b),this.redraw(),null!==this.options.onCropEnd&&this.options.onCropEnd(this.getValue()),this}},{key:'reset',value:function(){return this.box=this.initializeBox(this.options),this.redraw(),null!==this.options.onCropEnd&&this.options.onCropEnd(this.getValue()),this}}]),b}(n);return o});let croppr=new Croppr('#croppr',{onCropEnd:function(a){console.log(a.x,a.y,a.width,a.height)}}),value=croppr.getValue();const inputs=document.querySelectorAll('.controls input'),imgUrl=document.getElementById('photo-link'),imageInput=document.getElementById('file'),clippedImage=document.querySelector('.croppr-imageClipped'),originImage=document.querySelector('.croppr-image'),layer=document.querySelector('.layer'),originWidth=getComputedStyle(clippedImage).getPropertyValue('width'),downloadButton=document.getElementById('btn-download'),croppedRegion=document.querySelector('.croppr-region'),croppedOverlay=document.querySelector('.croppr-overlay'),croppedHandleContainer=document.querySelector('.croppr-handleContainer'),croppingButton=document.querySelector('.cropButton'),showCode=document.querySelector('[href="#css-code"]'),resetButton=document.querySelector('.reset'),ValueTextUpdate=(a,b)=>{let c=document.getElementById(`${a}-value`);null!==c&&(c.innerHTML=b)},setCropHandlesPosition=()=>{document.querySelector('.croppr-handle').style.transform=`translate(-5px, -5px)`,document.querySelector('.croppr-handle:nth-child(2)').style.transform=`translate(${clippedImage.clientWidth/2}px, -5px)`,document.querySelector('.croppr-handle:nth-child(3)').style.transform=`translate(${clippedImage.clientWidth-5}px, -5px)`,document.querySelector('.croppr-handle:nth-child(4)').style.transform=`translate(${clippedImage.clientWidth-5}px, ${clippedImage.clientHeight/2}px)`,document.querySelector('.croppr-handle:nth-child(5)').style.transform=`translate(${clippedImage.clientWidth-5}px, ${clippedImage.clientHeight-5}px)`,document.querySelector('.croppr-handle:nth-child(6)').style.transform=`translate(${clippedImage.clientWidth/2}px, ${clippedImage.clientHeight-5}px)`,document.querySelector('.croppr-handle:nth-child(7)').style.transform=`translate(-5px, ${clippedImage.clientHeight-5}px)`,document.querySelector('.croppr-handle:nth-child(8)').style.transform=`translate(-5px, ${clippedImage.clientHeight/2-5}px)`};(function(){document.querySelector('#width').value=originWidth.slice(0,-2),ValueTextUpdate('width',originWidth),setCropHandlesPosition()})();const updateDimensions=()=>{clippedImage.style.clip=`rect(0px, ${clippedImage.clientWidth}px, ${clippedImage.clientHeight}px, 0px`,layer.style.clip=`rect(0px, ${clippedImage.clientWidth}px, ${clippedImage.clientHeight}px, 0px`,croppedRegion.style.width=`${clippedImage.clientWidth}px`,croppedRegion.style.height=`${clippedImage.clientHeight}px`,croppedRegion.style.transform=`translate(0px, 0px)`},reset=()=>{document.getElementById('controls').reset(),document.querySelectorAll('.basic-controls input').forEach((a)=>{let b=`0${a.dataset.sizing}`;'width'==a.name?(document.documentElement.style.setProperty(`--${a.name}`,originWidth),ValueTextUpdate(a.name,originWidth)):'saturate'==a.name||'opacity'==a.name||'brightness'==a.name||'contrast'==a.name?(document.documentElement.style.setProperty(`--${a.name}`,'100%'),ValueTextUpdate(a.name,'100%')):(document.documentElement.style.setProperty(`--${a.name}`,b),ValueTextUpdate(a.name,b))}),updateDimensions(),originImage.classList.add('invisible'),croppedOverlay.classList.add('invisible'),croppedHandleContainer.classList.add('disabled'),croppedRegion.classList.add('disabled'),setCropHandlesPosition()},changeOverlay=(a)=>{let b=document.querySelector('.overlay-options'),c=a.target,d=c.getAttribute('id'),e=c[c.selectedIndex].value;document.documentElement.style.setProperty(`--${d}`,e)},inputUpdate=(a,b)=>{let c=void 0==a?b:a.target;const d=c.dataset.sizing||'';let e=c.name,f=c.value+d;ValueTextUpdate(e,f),document.documentElement.style.setProperty(`--${e}`,f);getComputedStyle(clippedImage).getPropertyValue('filter');'width'==e&&(updateDimensions(),setCropHandlesPosition())},downloadImage=()=>{let a=getComputedStyle(clippedImage).getPropertyValue('filter'),b=getComputedStyle(layer).getPropertyValue('mix-blend-mode'),d=getComputedStyle(layer).getPropertyValue('filter'),e=getComputedStyle(layer).getPropertyValue('background-color'),f=document.getElementById('gradient-color1').value,g=document.getElementById('gradient-color2').value,h=document.getElementById('color1-percent').value/100,i=document.getElementById('color2-percent').value/100,j=document.createElement('canvas'),c=j.getContext('2d');j.width=clippedImage.width,j.height=clippedImage.height;let k=clippedImage.width,l=clippedImage.height;c.filter=a,c.width=clippedImage.width,c.height=clippedImage.height;let m=getComputedStyle(clippedImage).getPropertyValue('clip');m=m.match(/\d+/g).map(Number);let n=m[0],o=k-m[1],p=l-m[2],q=m[3];m.length=4,n==void 0&&(n=0),o==void 0&&(o=0),p==void 0&&(p=0),q==void 0&&(q=0);let r=clippedImage.naturalWidth*q/k,s=clippedImage.naturalWidth*o/k,t=clippedImage.naturalHeight*n/l,u=clippedImage.naturalHeight*p/l,v=k-(o+q),w=l-(n+p),z=getComputedStyle(document.documentElement).getPropertyValue('--rotateL');z=z.startsWith('-')?-1*+z.match(/\d/g).join(''):+z.match(/\d/g).join('');let A=clippedImage.naturalWidth-r-s,B=clippedImage.naturalHeight-t-u;c.filter=a;let C,D=document.getElementById('gradient-direction').value;const E=(a,j)=>{document.getElementById('gradient-bcg').checked?('to right'===D?C=c.createLinearGradient(a,j,v,j):'to left'===D?C=c.createLinearGradient(v,j,a,j):'to bottom'===D?C=c.createLinearGradient(a,j,a,w):'to top'===D?C=c.createLinearGradient(a,w,a,j):'to bottom right'===D?C=c.createLinearGradient(a,j,v,w):'to bottom left'===D?C=c.createLinearGradient(v,j,a,w):'to top right'===D?C=c.createLinearGradient(a,w,v,j):'to top left'===D?C=c.createLinearGradient(v,w,a,j):void 0,C.addColorStop(h,f),C.addColorStop(i,g)):document.getElementById('solid-bcg').checked?C=e:document.getElementById('none-bcg').checked&&(C='transparent');c.fillStyle=C,c.globalCompositeOperation=b,c.filter=d};if(0!==z){j.width=2*clippedImage.width,j.height=2*clippedImage.height;let b=Math.PI/180,d=v/2,e=w/2;c.translate(j.width/2,j.height/2),c.rotate(z*b),c.filter=a,c.drawImage(clippedImage,r,t,A,B,-d,-e,v,w),E(-d,-e),c.fillRect(-d,-e,v,w)}else j.width=v,j.height=w,console.log(w),console.log(v),c.filter=a,c.drawImage(clippedImage,r,t,A,B,0,0,v,w),E(0,0),c.fillRect(0,0,v,w);let x=document.createElement('a'),y=j.toDataURL();x.href=y,x.download='myphoto.png',document.body.appendChild(x),x.click(),document.body.removeChild(x)},changeBackground=(a,b,c,d)=>{document.querySelector('.overlay-controls').classList.remove('disabled'),layer.classList.remove(b),layer.classList.add(a),document.querySelector(d).classList.add('disabled'),document.querySelector(c).classList.remove('disabled')},showCSSCode=()=>{let a=getComputedStyle(layer).getPropertyValue('background');a=document.getElementById('gradient-bcg').checked?a.split(' ').slice(4,-8).join(''):a.split(' ').slice(0,-9).join('');let b=getComputedStyle(clippedImage).getPropertyValue('filter');b=b.split(' ').filter((a)=>!a.includes('(0)')&&!a.includes('0deg')&&!a.includes('0px')&&!a.includes('saturate(1)')&&!a.includes('brightness(1)')&&!a.includes('contrast(1)')&&!a.includes('opacity(1)')).join(' ');let c=getComputedStyle(layer).getPropertyValue('mix-blend-mode'),d=getComputedStyle(layer).getPropertyValue('filter'),e=[]==b?'':`
filter: ${b};`,f=`
  .filter::before { <span class="pre-code">
    content: "";
    display: block;
    height: 100%;
    width: 100%;
    top: 0;
    left: 0;
    position: absolute;
    mix-blend-mode: ${c};
    filter: ${d};
    background: ${a};</span>
  }`;document.querySelector('.code-container').innerHTML=`
<pre>
.filter { <span class="pre-code">
    position: relative; ${e} </span>  
}
  ${document.getElementById('none-bcg').checked?'':f}
 </pre>
`},turnOnCropping=()=>{croppedRegion.classList.toggle('disabled'),originImage.classList.toggle('invisible'),croppedOverlay.classList.toggle('invisible'),croppedHandleContainer.classList.toggle('disabled')},loadURLImage=()=>{console.log('aaabbbb');''==imgUrl.value||(clippedImage.src=imgUrl.value,originImage.src=imgUrl.value,clippedImage.addEventListener('load',()=>{reset()}))},changeColorPercent=()=>{let a=event.target.parentNode.firstElementChild.value,b=event.target.parentNode.firstElementChild,c=0;c='+'==event.target.innerHTML?parseFloat(a)+1:0<a?parseFloat(a)-1:0,event.target.parentNode.firstElementChild.value=c,inputUpdate(void 0,b)};inputs.forEach((a)=>{a.addEventListener('change',inputUpdate)}),imageInput.addEventListener('change',(a)=>{a.target.files;if(window.File&&window.FileReader){let b=a.target.value,c=b.substring(b.lastIndexOf('.')+1).toLowerCase(),d=imageInput.files[0];if(d&&('gif'==c||'png'==c||'jpeg'==c||'jpg'==c)){let a=new FileReader;a.addEventListener('load',(a)=>{clippedImage.src=a.target.result,originImage.src=a.target.result,clippedImage.addEventListener('load',()=>{reset()})}),a.readAsDataURL(d)}else alert('Bad extension of file')}else alert('The File APIs are not fully supported in this browser.')}),document.getElementById('mode').addEventListener('change',changeOverlay),document.getElementById('gradient-direction').addEventListener('change',changeOverlay),document.addEventListener('click',(a)=>{if(a.target.matches('.photo-link-label'))document.querySelector('.photo-link-container').classList.add('active');else if(a.target.matches('.link-icon'))loadURLImage();else{if(a.target.closest('.photo-link-container')||a.target.closest('.photo-link-label'))return;document.querySelector('.photo-link-container').classList.remove('active')}a.target==resetButton&&reset(),a.target==downloadButton&&downloadImage(),a.target==showCode&&showCSSCode(),a.target==croppingButton&&turnOnCropping(),a.target.matches('#solid-bcg')&&changeBackground('solid-bcg','gradient-bcg','.overlay-color','.gradient-colors'),a.target.matches('#gradient-bcg')&&changeBackground('gradient-bcg','solid-bcg','.gradient-colors','.overlay-color'),a.target.matches('#none-bcg')&&(layer.classList.remove('solid-bcg','gradient-bcg'),document.querySelector('.overlay-controls').classList.add('disabled'));a.target.matches('.percent-color-button')&&changeColorPercent()}),document.addEventListener('DOMContentLoaded',function(){var a=document.querySelectorAll('select'),b=M.FormSelect.init(a)}),document.addEventListener('DOMContentLoaded',function(){var a=document.querySelectorAll('.tabs'),b=M.Tabs.init(a)});